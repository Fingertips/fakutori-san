recipe :ruby

process do |files|
  Ruby.run_tests(files.take_and_map do |file|
    case file
    when %r{^lib/(.*).rb$}
      "test/#{$1.gsub('/', '_')}_test.rb"
    when 'test/test_helper.rb'
      Dir.glob('test/*_test.rb')
    end
  end)
end